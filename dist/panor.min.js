!function(e){var a={showMenu:!1};e.fn.panor=function(n,t){var r,o,i,g,p,l={},d=e(this),c="webkitAnimationEnd oanimationend msAnimationEnd animationend";if(!d.data("panor")){var u=function(){d.wrapInner('<div class="panor-page-content current"></div>'),d.wrapInner('<div class="panor-page-inner"></div>'),d.wrapInner('<div class="panor-page-full"></div>'),d.wrapInner('<div class="panor-page"></div>'),l.panorPage=d.find(".panor-page").first(),l.panorPageInner=d.find(".panor-page-inner").first(),l.currentPageEl=d.find(".current").first(),E(),l.settings.showMenu&&s(),T(),A()},s=function(){d.append('<div class="panor-menu"></div>'),l.panorMenu=d.find(".panor-menu").first(),v(),f()},v=function(){var a="";l.parentPage&&(a+='<div data-direction="parent" data-page="'+l.parentPage+'"></div>'),e.each(l.currentLevel,function(n){a+='<div data-direction="next" data-page="'+n+'">',e.isEmptyObject(l.currentLevel[n])||(a+='<div data-direction="child" data-page="'+Object.keys(l.currentLevel[n])[0]+'"></div>'),a+="</div>"}),l.panorMenu.html(a)},f=function(e){l.panorMenu.find("div[data-page]").removeClass("active"),l.panorMenu.find('div[data-page="'+l.currentPage+'"]').addClass("active")},P=function(){var a=Object.keys(l.currentLevel),n=a[e.inArray(a[(e.inArray(l.currentPage,a)+1)%a.length],a)];if(l.currentPage===n)return x(),!1;l.loadingPage=!0,j("next"),b(n,"next")},m=function(){var a=Object.keys(l.currentLevel),n=a[e.inArray(a[(e.inArray(l.currentPage,a)-1+a.length)%a.length],a)];if(l.currentPage===n)return x(),!1;l.loadingPage=!0,j("prev"),b(n,"prev")},h=function(){if(l.parentPage===!1)return x(),!1;l.loadingPage=!0,j("parent");var e=k(l.pages,l.parentPage,!1);l.currentLevel=e.level,l.parentPage=e.parent,b(e.key,"parent")},w=function(){if(e.isEmptyObject(l.currentLevel[l.currentPage]))return l.loadingPage=!1,r=!1,A(!0),!1;l.loadingPage=!0,j("child");var a=Object.keys(l.currentLevel[l.currentPage]),n=k(l.pages,a[0],!1);l.currentLevel=n.level,l.parentPage=n.parent,b(n.key,"child")},L=function(e){l.loadingPage=!0,j("next"),b(e,"next",!0)},b=function(a,n,t){t=void 0!==t&&t,A(!0),e.get(a).done(function(r){j();var o='<div class="panor-page-content">'+e(r).filter(".panor").html()+"</div>";o=e(o);var i=e(r).closest("title").text();y(a,n,t,o,i)}).fail(function(){l.loadingPage=!1,r=!1,A(!0),console.log("error")})},y=function(a,n,t,r,o){var i=e(r),g="",p="";l.panorPageInner.append(i.addClass("panor-new")),"next"===n||"prev"===n?"next"===n?(g="pt-page-scaleDown",p="pt-page-moveFromRight pt-page-ontop"):"prev"===n&&(g="pt-page-scaleDown",p="pt-page-moveFromLeft pt-page-ontop"):"parent"!==n&&"child"!==n||("parent"===n?(g="pt-page-scaleDown",p="pt-page-moveFromTop pt-page-ontop"):"child"===n&&(g="pt-page-scaleDown",p="pt-page-moveFromBottom pt-page-ontop")),l.currentPageEl.addClass(g).on(c,function(){l.currentPageEl.off(c),l.animateCurrent=!0,l.animateCurrent&&C(a,n,t,i,o,p)}),i.addClass(p).on(c,function(){i.off(c),l.animateNew=!0,l.animateNew&&C(a,n,t,i,o,p)})},A=function(e,a){e=void 0!==e&&e,a=void 0!==a?a:400,e?l.panorPage.animate({scrollLeft:l.panorPage.width()/2,scrollTop:l.panorPage.height()/2},{duration:a,queue:!1}):(l.panorPage.scrollLeft(l.panorPage.width()/2),l.panorPage.scrollTop(l.panorPage.height()/2))},E=function(){var e=window.location.href,a=k(l.pages,e,!1);l.currentPage=a.key,l.currentLevel=a.level,l.parentPage=a.parent,"object"!=typeof a&&console.log("error")},k=function(a,n,t){var r=!1;for(var o in a)if(a.hasOwnProperty(o)){if(o==n)return{level:a,key:n,parent:t};if("object"==typeof a[o]&&!e.isEmptyObject(a[o])){var i=k(a[o],n,o);if("object"==typeof i){r=i;break}}}return r},C=function(e,a,n,t,o,i){l.animateCurrent=!1,l.animateNew=!1,l.currentPageEl.remove(),t.removeClass(i+" panor-new").addClass("current"),n||window.history.pushState({pageLink:e},o,e),document.title=o,l.currentPageEl=t,l.currentPage=e,l.loadingPage=!1,r=!1,!l.settings.showMenu||"child"!==a&&"parent"!==a?f():(v(),f())},j=function(a){l.panorPageInner.find(l.loadingAnimationEl).length?l.loadingAnimationEl.fadeOut(300,function(){e(this).remove(),l.loadingAnimationEl.removeClass("panor-loading-next panor-loading-prev panor-loading-parent panor-loading-child")}):l.loadingAnimationEl.addClass("panor-loading-"+a).hide().appendTo(l.panorPageInner).fadeIn(300)},x=function(){l.loadingPage=!1,r=!1,A(!0)},T=function(){e(window).bind("resize",I),window.addEventListener("popstate",M),l.panorPage.bind("mousedown","event",O),l.panorPage.bind("mousemove","event",D),l.panorPage.bind("mouseup","event",F),l.settings.showMenu&&l.panorMenu.bind("click","event",N)},I=function(){l.loadingPage||A()},M=function(e){l.panorPage.animate({scrollLeft:l.panorPage.width()},400,function(){L(e.state.pageLink)})},O=function(e){e.preventDefault(),r=!0,o=e.pageX,i=e.pageY,g=l.panorPage.scrollLeft(),p=l.panorPage.scrollTop()},D=function(e){r&&!l.loadingPage&&(l.panorPage.scrollLeft()<=.25*l.panorPage.width()?(l.loadingPage=!0,m()):l.panorPage.scrollLeft()>=.75*l.panorPage.width()?(l.loadingPage=!0,P()):l.panorPage.scrollTop()<=.25*l.panorPage.height()?(l.loadingPage=!0,h()):l.panorPage.scrollTop()>=.75*l.panorPage.height()?(l.loadingPage=!0,w()):l.loadingPage=!1,l.panorPage.scrollLeft(g-e.pageX+o),l.panorPage.scrollTop(p-e.pageY+i))},F=function(e){r=!1,l.loadingPage||A(!0)},N=function(e){if(e.target.getAttribute("data-page")&&e.target.getAttribute("data-page")!=l.currentPage){var a=e.target.getAttribute("data-direction")||"next";"parent"===a?l.panorPage.animate({scrollTop:.25*l.panorPage.height()},400,function(){var n=k(l.pages,e.target.getAttribute("data-page"),!1);l.currentLevel=n.level,l.parentPage=n.parent,j(a),b(e.target.getAttribute("data-page"),a)}):"child"===a?l.panorPage.animate({scrollTop:.75*l.panorPage.height()},400,function(){var n=k(l.pages,e.target.getAttribute("data-page"),!1);l.currentLevel=n.level,l.parentPage=n.parent,j(a),b(e.target.getAttribute("data-page"),a)}):l.panorPage.animate({scrollLeft:.75*l.panorPage.width()},400,function(){j(a),b(e.target.getAttribute("data-page"),a)})}};return function(){d.data("panor")||(l.settings=e.extend({},a,t),l.pages=n,l.currentPage=0,l.currentLevel={},l.parentPage=!1,l.loadingPage=!1,l.animateCurrent=!1,l.animateNew=!1,l.loadingAnimationEl=e('<div class="panor-loading"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>'),window.history.replaceState({pageLink:document.location.href},document.title,document.location.href),u())}(),d.data("panor",this),this}}}(jQuery);