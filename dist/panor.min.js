!function(e){var a={showMenu:!1};e.fn.panor=function(n,t){var r,o,i,p,g,l={},c=e(this),d="webkitAnimationEnd oanimationend msAnimationEnd animationend";if(!c.data("panor")){var s=function(){c.wrapInner('<div class="panor-page-content current"></div>'),c.wrapInner('<div class="panor-page-inner"></div>'),c.wrapInner('<div class="panor-page-full"></div>'),c.wrapInner('<div class="panor-page"></div>'),l.panorPage=c.find(".panor-page").first(),l.panorPageInner=c.find(".panor-page-inner").first(),l.currentPageEl=c.find(".current").first(),A(),l.settings.showMenu&&u(),C(),y()},u=function(){c.append('<div class="panor-menu"></div>'),l.panorMenu=c.find(".panor-menu").first(),f()},f=function(){var a="";l.parentPage&&(a+='<div data-direction="parent" data-page="'+l.parentPage+'"></div>'),e.each(l.currentLevel,function(n){a+='<div data-direction="next" data-page="'+n+'">',e.isEmptyObject(l.currentLevel[n])||(a+='<div data-direction="child" data-page="'+Object.keys(l.currentLevel[n])[0]+'"></div>'),a+="</div>"}),l.panorMenu.html(a)},v=function(){var a=Object.keys(l.currentLevel),n=a[e.inArray(a[(e.inArray(l.currentPage,a)+1)%a.length],a)];if(l.currentPage===n)return x(),!1;l.loadingPage=!0,j("next"),L(n,"next")},P=function(){var a=Object.keys(l.currentLevel),n=a[e.inArray(a[(e.inArray(l.currentPage,a)-1+a.length)%a.length],a)];if(l.currentPage===n)return x(),!1;l.loadingPage=!0,j("prev"),L(n,"prev")},m=function(){if(l.parentPage===!1)return x(),!1;l.loadingPage=!0,j("parent");var e=E(l.pages,l.parentPage,!1);l.currentLevel=e.level,l.parentPage=e.parent,L(e.key,"parent")},h=function(){if(e.isEmptyObject(l.currentLevel[l.currentPage]))return l.loadingPage=!1,r=!1,y(!0),!1;l.loadingPage=!0,j("child");var a=Object.keys(l.currentLevel[l.currentPage]),n=E(l.pages,a[0],!1);l.currentLevel=n.level,l.parentPage=n.parent,L(n.key,"child")},w=function(e){l.loadingPage=!0,j("next"),L(e,"next",!0)},L=function(a,n,t){t=void 0!==t&&t,e.post(a).done(function(r){j();var o='<div class="panor-page-content">'+e(r).filter(".panor").html()+"</div>";o=e(o);var i=e(r).closest("title").text();b(a,n,t,o,i)}).fail(function(){l.loadingPage=!1,r=!1,y(!0),console.log("error")})},b=function(a,n,t,r,o){var i=e(r),p="",g="";l.panorPageInner.append(i.addClass("panor-new")),"next"===n||"prev"===n?("next"===n?(p="pt-page-scaleDown",g="pt-page-moveFromRight pt-page-ontop"):"prev"===n&&(p="pt-page-scaleDown",g="pt-page-moveFromLeft pt-page-ontop"),l.panorPage.animate({scrollTop:l.panorPage.offset().top+l.panorPage.height()/4},{duration:900,queue:!1})):"parent"!==n&&"child"!==n||("parent"===n?(p="pt-page-scaleDown",g="pt-page-moveFromTop pt-page-ontop"):"child"===n&&(p="pt-page-scaleDown",g="pt-page-moveFromBottom pt-page-ontop"),l.panorPage.animate({scrollLeft:l.panorPage.offset().left+l.panorPage.width()/4},{duration:900,queue:!1})),l.currentPageEl.addClass(p).on(d,function(){l.currentPageEl.off(d),l.animateCurrent=!0,l.animateCurrent&&k(a,n,t,i,o,g)}),i.addClass(g).on(d,function(){i.off(d),l.animateNew=!0,l.animateNew&&k(a,n,t,i,o,g)})},y=function(e){e=void 0!==e&&e,e?l.panorPage.animate({scrollLeft:l.panorPage.offset().left+l.panorPage.width()/4,scrollTop:l.panorPage.offset().top+l.panorPage.height()/4},{duration:400,queue:!1}):(l.panorPage.scrollLeft(l.panorPage.offset().left+l.panorPage.width()/4),l.panorPage.scrollTop(l.panorPage.offset().top+l.panorPage.height()/4))},A=function(){var e=window.location.href,a=E(l.pages,e,!1);l.currentPage=a.key,l.currentLevel=a.level,l.parentPage=a.parent,console.log(e),console.log(l.pages),"object"!=typeof a&&console.log("error")},E=function(a,n,t){var r=!1;for(var o in a)if(a.hasOwnProperty(o)){if(o==n)return{level:a,key:n,parent:t};if("object"==typeof a[o]&&!e.isEmptyObject(a[o])){var i=E(a[o],n,o);if("object"==typeof i){r=i;break}}}return r},k=function(e,a,n,t,o,i){y(),l.animateCurrent=!1,l.animateNew=!1,l.currentPageEl.remove(),t.removeClass(i+" panor-new").addClass("current"),n||window.history.pushState({pageLink:e},o,e),document.title=o,l.currentPageEl=t,l.currentPage=e,l.loadingPage=!1,r=!1,!l.settings.showMenu||"child"!==a&&"parent"!==a||f()},j=function(a){l.panorPageInner.find(l.loadingAnimationEl).length?l.loadingAnimationEl.fadeOut(300,function(){e(this).remove(),l.loadingAnimationEl.removeClass("panor-loading-next panor-loading-prev panor-loading-parent panor-loading-child")}):l.loadingAnimationEl.addClass("panor-loading-"+a).hide().appendTo(l.panorPageInner).fadeIn(300)},x=function(){l.loadingPage=!1,r=!1,y(!0)},C=function(){e(window).bind("resize",I),window.addEventListener("popstate",O),l.panorPage.bind("mousedown","event",T),l.panorPage.bind("mousemove","event",M),l.panorPage.bind("mouseup","event",D),l.settings.showMenu&&l.panorMenu.bind("click","event",F)},I=function(){l.loadingPage||y()},O=function(e){l.panorPage.animate({scrollLeft:l.panorPage.width()},400,function(){w(e.state.pageLink)})},T=function(e){e.preventDefault(),r=!0,o=e.pageX,i=e.pageY,p=l.panorPage.scrollLeft(),g=l.panorPage.scrollTop()},M=function(e){r&&!l.loadingPage&&(l.panorPage.scrollLeft()<=20?(l.loadingPage=!0,P()):l.panorPage.scrollLeft()-l.panorPage.width()/2>=-20?(l.loadingPage=!0,v()):l.panorPage.scrollTop()<=20?(l.loadingPage=!0,m()):l.panorPage.scrollTop()-l.panorPage.height()/2>=-20?(l.loadingPage=!0,h()):l.loadingPage=!1,l.panorPage.scrollLeft(p-e.pageX+o),l.panorPage.scrollTop(g-e.pageY+i))},D=function(e){r=!1,l.loadingPage||y(!0)},F=function(e){e.target.getAttribute("data-page")&&e.target.getAttribute("data-page")!=l.currentPage&&l.panorPage.animate({scrollLeft:l.panorPage.width()},400,function(){l.loadingPage=!0;var a=e.target.getAttribute("data-direction")||"next";if("parent"===a||"child"===a){var n=E(l.pages,e.target.getAttribute("data-page"),!1);l.currentLevel=n.level,l.parentPage=n.parent}j(a),L(e.target.getAttribute("data-page"),a)})};return function(){c.data("panor")||(l.settings=e.extend({},a,t),l.pages=n,l.currentPage=0,l.currentLevel={},l.parentPage=!1,l.loadingPage=!1,l.animateCurrent=!1,l.animateNew=!1,l.loadingAnimationEl=e('<div class="panor-loading"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>'),window.history.replaceState({pageLink:document.location.href},document.title,document.location.href),s())}(),c.data("panor",this),this}}}(jQuery);